<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <title>DMA - Quản trị</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-light p-4">
    <div class="container">
        <div class="d-flex justify-content-between align-items-center mb-3">
            <h3>Trang quản trị DMA</h3>
            <button class="btn btn-danger" id="logoutBtn">Đăng xuất</button>
        </div>

        <div id="alert" class="alert d-none"></div>

        <table class="table table-bordered">
            <thead class="table-primary">
                <tr>
                    <th>Tên người dùng</th>
                    <th>Số điện thoại</th>
                    <th>Xác thực</th>
                    <th>Token</th>
                    <th>Hành động</th>
                </tr>
            </thead>
            <tbody id="userTable"></tbody>
        </table>
    </div>

    <script>
const apiBase = "https://localhost:5001/api/auth";
const alertBox = document.getElementById("alert");

async function loadUsers() {
  const res = await fetch(`${apiBase}/users`);
  const users = await res.json();
  const tbody = document.getElementById("userTable");
  tbody.innerHTML = "";

  users.forEach(u => {
    const tr = document.createElement("tr");
    tr.innerHTML = `
      <td>${u.username}</td>
      <td>${u.phone}</td>
      <td>${u.verified ? "✅" : "❌"}</td>
      <td>${u.refreshToken ?? "<i>None</i>"}</td>
      <td>
        <button class="btn btn-sm btn-outline-danger" onclick="clearToken('${u.username}')">Clear Token</button>
      </td>`;
    tbody.appendChild(tr);
  });
}

async function clearToken(username) {
  if (!confirm(`Xóa token của ${username}?`)) return;

  const res = await fetch(`${apiBase}/clear-token/${username}`, { method: "POST" });
  const data = await res.json();

  if (res.ok) {
    alertBox.className = "alert alert-success";
    alertBox.textContent = data.message;
  } else {
    alertBox.className = "alert alert-danger";
    alertBox.textContent = data.message || "Lỗi khi xóa token";
  }
  alertBox.classList.remove("d-none");
  loadUsers();
}

document.getElementById("logoutBtn").onclick = () => {
  localStorage.clear();
  window.location.href = "login.html";
};

loadUsers();
    </script>
</body>
</html>
